<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Chuio Admin Portal">
  <link rel="icon" type="image/x-icon" href="/uploads/chuio/favicon%20(1).ico">
  <title>Admin Portal | Chuio</title>

  <!-- QR code library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <!-- Admin CSS -->
  <link rel="stylesheet" href="/admin.css" />
</head>

<body>

  <!-- ================= STAFF LOGIN SCREEN ================= -->
  <div id="login-screen" class="login-screen">
    <div class="login-container">
      <div class="login-header">
        <img src="/uploads/chuio/chuio_logo.png" class="favicon-logo" alt="Chuio Logo" style="height: 80px;" />
        <p>Staff Portal</p>
      </div>

      <div id="pin-login">
        <h2>Enter PIN</h2>

        <div id="pin-dots">
          <span></span><span></span><span></span><span></span><span></span><span></span>
        </div>

        <div class="keypad">
          <button onclick="pressKey(1)">1</button>
          <button onclick="pressKey(2)">2</button>
          <button onclick="pressKey(3)">3</button>

          <button onclick="pressKey(4)">4</button>
          <button onclick="pressKey(5)">5</button>
          <button onclick="pressKey(6)">6</button>

          <button onclick="pressKey(7)">7</button>
          <button onclick="pressKey(8)">8</button>
          <button onclick="pressKey(9)">9</button>

          <button class="clear" onclick="clearPin()">‚å´</button>
          <button onclick="pressKey(0)">0</button>
          <button class="enter" onclick="submitPin()">‚èé</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= MAIN APP (hidden until login) ================= -->
  <div id="app-container" class="app-container" style="display: none;">
    
    <!-- HEADER -->
    <header class="app-header">
      <div class="header-left">
        <h1>üçΩÔ∏è Restaurant Portal</h1>
      </div>
      <div class="header-right">
        <div id="restaurant-selector" class="restaurant-selector" style="display: none;">
          <button class="restaurant-name-btn" id="restaurant-name-btn" onclick="toggleRestaurantList()"></button>
          <div id="restaurant-list" class="restaurant-list" style="display: none;">
            <!-- Populated by JS -->
          </div>
        </div>
        <button id="pin-login-btn" class="pin-login-btn" onclick="openPinLoginModal()">üîê PIN</button>
        <button id="logout-btn" class="logout-btn" onclick="handleLogout()">Logout</button>
      </div>
    </header>

    <!-- SIDEBAR NAVIGATION -->
    <div class="app-wrapper">
      <nav class="sidebar">
        <div class="sidebar-menu">
          <button class="menu-btn active" data-section="tables" onclick="switchSection('tables')">
            <span class="icon">üçΩÔ∏è</span>
            <span>Tables</span>
          </button>
          <button class="menu-btn" data-section="menu" onclick="switchSection('menu')" id="menu-nav-btn">
            <span class="icon">üìã</span>
            <span>Menu</span>
          </button>
          <button class="menu-btn" data-section="tables-mgmt" onclick="switchSection('tables-mgmt')" id="tables-mgmt-nav-btn">
            <span class="icon">‚öôÔ∏è</span>
            <span>Table Mgmt</span>
          </button>
          <button class="menu-btn" data-section="coupons" onclick="switchSection('coupons')" id="coupons-nav-btn">
            <span class="icon">üé´</span>
            <span>Coupons</span>
          </button>
          <button class="menu-btn" data-section="staff" onclick="switchSection('staff')" id="staff-nav-btn">
            <span class="icon">üë•</span>
            <span>Staff</span>
          </button>
          <button class="menu-btn" data-section="settings" onclick="switchSection('settings')" id="settings-nav-btn">
            <span class="icon">‚öôÔ∏è</span>
            <span>Settings</span>
          </button>
        </div>
      </nav>

      <!-- MAIN CONTENT -->
      <main class="main-content">

        <!-- ================= TABLES SECTION (DEFAULT) ================= -->
        <section id="section-tables" class="content-section active">
          <h2>üçΩ Tables & Orders</h2>

          <!-- Category Tabs -->
          <div id="tables-category-tabs" class="table-tabs"></div>

          <!-- Tables Grid + Session Panel -->
          <div class="tables-container">
            <div id="tables-grid" class="tables-grid">
              <!-- JS renders table cards here -->
            </div>

            <div id="session-order-panel" class="session-panel">
              <p>Select a session to view orders</p>
            </div>
          </div>
        </section>

        <!-- ================= MENU MANAGEMENT SECTION ================= -->
        <section id="section-menu" class="content-section admin-only">
          <h2>üìã Menu Management</h2>

          <div class="section-card">
            <h3>
              Add Menu Item
              <button class="btn-secondary" onclick="startCreateItem()">‚ûï Add Item</button>
            </h3>

            <div id="create-item-form" style="display:none;">
              <div class="form-row">
                <div class="form-group">
                  <label>Item Name</label>
                  <input id="new-item-name" placeholder="e.g., Caesar Salad" />
                </div>
                <div class="form-group">
                  <label>Price (cents)</label>
                  <input id="new-item-price" type="number" placeholder="e.g., 1200" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Category</label>
                  <select id="new-item-category" required>
                    <option value="">-- Select a category --</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
              <div class="form-group">
                <label>Description</label>
                <textarea id="new-item-desc" placeholder="Add a detailed description of the menu item..."></textarea>
              </div>
            </div>
              <div class="form-group">
                <label>Food Item Image <span class="info-hint">(Recommended: 400px √ó 300px)</span></label>
                <div class="image-upload-input">
                  <div id="new-item-image-preview" class="image-preview-box">
                    <div class="upload-placeholder">üì∏ Click to upload image</div>
                  </div>
                  <input type="file" id="new-item-image" accept="image/*" onchange="previewItemImage(this)" class="hidden-file-input"/>
                </div>
              </div>
              <div class="form-actions">
                <button onclick="createMenuItem()" class="btn-primary">‚úì Create Item</button>
                <button onclick="cancelCreateItem()" class="btn-secondary">‚úï Cancel</button>
              </div>
            </div>
          </div>

          <div id="menu-items">
            <!-- JS renders categories + items here -->
          </div>
        </section>

        <!-- ================= COUPONS MANAGEMENT SECTION ================= -->
        <section id="section-coupons" class="content-section admin-only">
          <h2>üé´ Coupons & Discounts</h2>

          <div class="section-card">
            <h3>Create New Coupon</h3>
            <div id="coupon-error" class="error-message" style="display: none;"></div>
            <div id="coupon-success" class="success-message" style="display: none;"></div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Coupon Code</label>
                <input id="new-coupon-code" placeholder="e.g., SUMMER20" maxlength="50" style="text-transform: uppercase;" />
              </div>
              <div class="form-group">
                <label>Discount Type</label>
                <select id="new-coupon-type">
                  <option value="percentage">Percentage (%)</option>
                  <option value="fixed">Fixed Amount ($)</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Discount Value</label>
                <input id="new-coupon-value" type="number" placeholder="e.g., 20" step="0.01" />
              </div>
              <div class="form-group">
                <label>Minimum Order Value ($)</label>
                <input id="new-coupon-min-order" type="number" placeholder="e.g., 50" step="0.01" value="0" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Max Uses (leave blank for unlimited)</label>
                <input id="new-coupon-max-uses" type="number" placeholder="e.g., 100" />
              </div>
              <div class="form-group">
                <label>Valid Until</label>
                <input id="new-coupon-valid-until" type="date" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Description</label>
                <textarea id="new-coupon-description" placeholder="e.g., Summer special - 20% off all items"></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button onclick="createCoupon()" class="btn-primary">‚ûï Create Coupon</button>
            </div>
          </div>

          <div id="coupons-list" class="section-card">
            <!-- JS renders coupons here -->
          </div>
        </section>

        <!-- ================= STAFF MANAGEMENT SECTION ================= -->
        <section id="section-staff" class="content-section admin-only">
          <h2>üë• Staff Management</h2>

          <div class="section-card">
            <h3>Create New Staff</h3>
            <div id="staff-error" class="error-message" style="display: none;"></div>
            <div id="staff-success" class="success-message" style="display: none;"></div>
            
            <form onsubmit="event.preventDefault(); createStaff();">
              <div class="form-row">
                <div class="form-group">
                  <label>Staff Name</label>
                  <input id="staff-name" placeholder="e.g., John Smith" />
                </div>
                <div class="form-group">
                  <label>Email Address</label>
                  <input id="staff-email" type="email" autocomplete="email" placeholder="e.g., john@restaurant.com" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Password</label>
                    <input id="staff-password" type="password" placeholder="Enter secure password" autocomplete="current-password" required>
                </div>
                <div class="form-group">
                  <label>PIN (6 digits)</label>
                  <input id="staff-pin" type="text" placeholder="e.g., 123456" maxlength="6" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Role</label>
                  <select id="staff-role" required>
                    <option value="staff">Staff</option>
                    <option value="kitchen">Kitchen</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary">‚ûï Create Staff</button>
              </div>
            </form>
          </div>

          <div id="staff-list">
            <!-- JS renders staff here -->
          </div>
        </section>

        <!-- ================= TABLE MANAGEMENT SECTION ================= -->
        <section id="section-tables-mgmt" class="content-section admin-only">
          <h2>‚öôÔ∏è Table Management</h2>

          <!-- Create Category -->
          <div class="section-card">
            <h3>Create Table Category</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Category Name</label>
                <input id="new-tables-category-name" placeholder="e.g., VIP, Bar, Outdoor, Main Dining" />
              </div>
            </div>
            <div class="form-actions">
              <button onclick="createTablesCategory()" class="btn-primary">‚ûï Add Category</button>
            </div>
          </div>

          <!-- List Table Categories -->
          <div class="section-card">
            <h3>Table Categories</h3>
            <div id="table-categories-list" class="list-grid">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Add Table Form -->
          <div class="section-card">
            <h3>Add Table</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Select Category</label>
                <select id="new-table-category">
                  <option value="">-- Select Category --</option>
                </select>
              </div>
              <div class="form-group">
                <label>Table Name</label>
                <input id="new-table-name" placeholder="e.g., T1, T-Patio-01" />
              </div>
              <div class="form-group">
                <label>Number of Seats</label>
                <input id="new-table-seats" type="number" placeholder="1" value="1" />
              </div>
            </div>
            <div class="form-actions">
              <button onclick="createTable()" class="btn-primary">‚ûï Add Table</button>
            </div>
          </div>

          <!-- List Tables -->
          <div class="section-card">
            <h3>Manage Tables</h3>
            <div id="tables-list" class="list-grid">
              <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <!-- ================= SETTINGS SECTION ================= -->
        <section id="section-settings" class="content-section admin-only">
          <h2>‚öôÔ∏è Admin Settings</h2>

          <div class="section-card" id="restaurant-header">
            <h3>Restaurant Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label>Restaurant Name</label>
                <span id="view-name" class="view-mode"></span>
                <input id="restaurant-name" placeholder="e.g., The Italian Kitchen" style="display:none;" />
              </div>
              <div class="form-group">
                <label>Phone</label>
                <span id="view-phone" class="view-mode"></span>
                <input id="restaurant-phone" placeholder="e.g., (555) 123-4567" style="display:none;" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Address</label>
                <span id="view-address" class="view-mode"></span>
                <input id="restaurant-address" placeholder="e.g., 123 Main St, City, State" style="display:none;" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Service Charge (%)</label>
                <span id="view-service-charge" class="view-mode"></span>
                <input id="serviceChargeInput" type="number" min="0" step="0.1" placeholder="e.g., 15" style="display:none;" />
              </div>
              <div class="form-group">
                <label>Theme Color</label>
                <span id="view-color" class="view-mode"></span>
                <input type="color" id="colorInput" style="display:none;" />
              </div>
            </div>

            <div class="form-group">
              <label>Restaurant Logo</label>
              <img id="restaurant-logo" class="logo-preview" style="display:none;" />
              <input id="logoInput" type="file" accept="image/*" style="display:none;" 
                onchange="uploadRestaurantLogo(this.files[0])" />
            </div>

            <div class="form-actions">
              <button id="edit-settings-btn" onclick="enterEditMode()" class="btn-primary">‚úé Edit Settings</button>
              <button id="save-settings-btn" onclick="saveAdminSettings()" style="display:none;" class="btn-primary">‚úì Save</button>
              <button id="cancel-settings-btn" onclick="cancelEditMode()" style="display:none;" class="btn-secondary">Cancel</button>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- ================= PIN LOGIN MODAL ================= -->
  <div id="pin-modal-overlay" class="modal-overlay" style="display: none;" onclick="closePinLoginModal()"></div>
  <div id="pin-modal" class="pin-modal" style="display: none;">
    <div class="pin-modal-content">
      <h2>Enter PIN</h2>
      <p>Switch user account</p>
      
      <div id="modal-pin-dots">
        <span></span><span></span><span></span><span></span><span></span><span></span>
      </div>

      <div class="keypad">
        <button onclick="pressKeyModal(1)">1</button>
        <button onclick="pressKeyModal(2)">2</button>
        <button onclick="pressKeyModal(3)">3</button>

        <button onclick="pressKeyModal(4)">4</button>
        <button onclick="pressKeyModal(5)">5</button>
        <button onclick="pressKeyModal(6)">6</button>

        <button onclick="pressKeyModal(7)">7</button>
        <button onclick="pressKeyModal(8)">8</button>
        <button onclick="pressKeyModal(9)">9</button>

        <button class="clear" onclick="clearPinModal()">‚å´</button>
        <button onclick="pressKeyModal(0)">0</button>
        <button class="enter" onclick="submitPinModal()">‚èé</button>
      </div>

      <button class="close-btn" onclick="closePinLoginModal()">Close</button>
    </div>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="/admin.js"></script>
</body>
</html>
