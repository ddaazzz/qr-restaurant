<!DOCTYPE html>
<html>
<head>
  <title>Kitchen Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .table {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .item:last-child {
      border-bottom: none;
    }

    .status {
      font-weight: bold;
      margin-left: 10px;
      color: orange;
    }

    button {
      padding: 6px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>üç≥ Kitchen Items</h1>
  <div id="items">Loading...</div>

  <script>
    async function loadItems() {
      const res = await fetch("http://localhost:3000/api/kitchen/items");
      const items = await res.json();
      const container = document.getElementById("items");
      container.innerHTML = "";

      
      if (items.length === 0) {
        container.innerHTML = "<p>No active kitchen items.</p>";
        return;
      }

      // Group items by table
      const tableMap = {};

      items.forEach(item => {
        if (!tableMap[item.table_name]) {
          tableMap[item.table_name] = [];
        }
        tableMap[item.table_name].push(item);
      });

      Object.entries(tableMap).forEach(([tableName, tableItems]) => {
        const tableDiv = document.createElement("div");
        tableDiv.className = "table";

        tableDiv.innerHTML = `<h3>Table: ${tableName}</h3>`;

        tableItems.forEach(item => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";

          itemDiv.innerHTML = `
            <div>
              ${item.quantity} √ó ${item.item_name}
              ${item.variants ? `<br><small>${item.variants}</small>` : ""}
              <span class="status">(${item.status})</span>

            </div>
            <div>
              ${
                item.status === "pending"
                  ? `<button onclick="updateItemStatus(${item.order_item_id}, 'preparing')">Start</button>`
                  : ""
              }
              ${
                item.status === "preparing"
                  ? `<button onclick="updateItemStatus(${item.order_item_id}, 'served')">Serve</button>`
                  : ""
              }
            </div>
          `;

          tableDiv.appendChild(itemDiv);
        });

        container.appendChild(tableDiv);
      });
    }

    async function updateItemStatus(orderItemId, status) {
      await fetch(
        `http://localhost:3000/api/order-items/${orderItemId}/status`,
        {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ status })
        }
      );

      loadItems();
    }

    loadItems();
    setInterval(loadItems, 5000);
  </script>

</body>
</html>
